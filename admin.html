<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Master Panel - APIP STORE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #020617; color: white; }
        .glass { background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.05); }
        .sidebar-active { background: #3b82f6; color: white; box-shadow: 0 0 20px rgba(59, 130, 246, 0.4); }
        .input-field { background: #0f172a; border: 1px solid rgba(255,255,255,0.1); padding: 12px; border-radius: 12px; font-size: 14px; outline: none; transition: 0.3s; }
        .input-field:focus { border-color: #3b82f6; box-shadow: 0 0 10px rgba(59, 130, 246, 0.2); }
    </style>
</head>
<body class="flex flex-col md:flex-row min-h-screen">

    <aside class="w-full md:w-64 glass p-6 border-r border-white/5 flex flex-col justify-between">
        <div class="space-y-8">
            <h1 class="text-xl font-black text-center text-blue-500 uppercase tracking-tighter">Apip Panel</h1>
            <nav class="space-y-3">
                <button onclick="switchTab('produk')" id="btn-produk" class="w-full p-4 rounded-2xl flex items-center space-x-4 sidebar-active transition">
                    <i class="fas fa-box"></i> <span class="text-xs font-bold uppercase">Manajemen Produk</span>
                </button>
                <button onclick="switchTab('transaksi')" id="btn-transaksi" class="w-full p-4 rounded-2xl flex items-center space-x-4 hover:bg-white/5 transition">
                    <i class="fas fa-receipt"></i> <span class="text-xs font-bold uppercase">Riwayat Transaksi</span>
                </button>
            </nav>
        </div>

        <button onclick="logout()" class="mt-10 w-full p-4 rounded-2xl flex items-center space-x-4 text-red-400 hover:bg-red-500/10 transition border border-red-500/20">
            <i class="fas fa-sign-out-alt"></i> <span class="text-xs font-bold uppercase">Keluar Admin</span>
        </button>
    </aside>

    <main class="flex-1 p-6 md:p-12 max-w-7xl mx-auto w-full">
        
        <div id="tab-produk" class="tab-content space-y-8">
            <div class="flex justify-between items-center">
                <h2 class="text-2xl font-extrabold tracking-tight">Manajemen <span class="text-blue-500">Produk</span></h2>
            </div>

            <div class="glass p-8 rounded-[2rem] border border-blue-500/10">
                <h3 id="formTitle" class="text-[10px] font-black uppercase text-blue-400 mb-6 tracking-widest">Tambah Produk Baru</h3>
                <form id="formProduk" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <input type="hidden" id="editIndex">
                    
                    <div class="flex flex-col space-y-2">
                        <label class="text-[10px] uppercase font-bold text-slate-400 ml-1">Kategori Game</label>
                        <select id="game" class="input-field text-white">
                            <option value="Mobile Legends">Mobile Legends</option>
                            <option value="Free Fire">Free Fire</option>
                            <option value="PUBG Mobile">PUBG Mobile</option>
                        </select>
                    </div>

                    <div class="flex flex-col space-y-2">
                        <label class="text-[10px] uppercase font-bold text-slate-400 ml-1">Sub Kategori</label>
                        <select id="sub" class="input-field text-blue-400 font-bold">
                            <option value="Diamonds ML">Diamonds ML</option>
                            <option value="Weekly Pass">Weekly Pass</option>
                            <option value="Membership">Membership</option>
                        </select>
                    </div>

                    <div class="flex flex-col space-y-2">
                        <label class="text-[10px] uppercase font-bold text-slate-400 ml-1">Nama Item/Voucher</label>
                        <input type="text" id="nama" placeholder="Contoh: 86 Diamonds" class="input-field" required>
                    </div>

                    <div class="flex flex-col space-y-2">
                        <label class="text-[10px] uppercase font-bold text-slate-400 ml-1">Harga (Rupiah)</label>
                        <div class="relative">
                            <span class="absolute left-4 top-3 text-slate-500 text-sm">Rp</span>
                            <input type="number" id="harga" placeholder="0" class="input-field w-full pl-10" required>
                        </div>
                    </div>

                    <div class="lg:col-span-4 flex justify-end space-x-3">
                        <button type="button" onclick="resetForm()" class="px-6 py-3 rounded-xl font-bold text-[10px] uppercase hover:bg-white/5 transition">Batal</button>
                        <button id="btnSimpan" class="bg-blue-600 hover:bg-blue-500 px-8 py-3 rounded-xl font-black text-[10px] uppercase transition shadow-lg shadow-blue-500/20">Simpan Produk</button>
                    </div>
                </form>
            </div>

            <div class="glass rounded-[2rem] overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full text-left">
                        <thead class="bg-slate-900/50 text-[10px] uppercase text-slate-500 border-b border-white/5">
                            <tr>
                                <th class="p-6">Detail Produk</th>
                                <th class="p-6">Harga Jual</th>
                                <th class="p-6 text-center">Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="listProduk" class="divide-y divide-white/5">
                            </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="tab-transaksi" class="tab-content hidden space-y-6">
            <h2 class="text-2xl font-extrabold tracking-tight">Kelola <span class="text-blue-500">Transaksi</span></h2>
            <div class="glass p-4 rounded-2xl flex items-center px-6 border border-white/5">
                <i class="fas fa-search text-slate-500 mr-4"></i>
                <input type="text" id="cariInv" onkeyup="cariTabel()" placeholder="Cari No. Invoice (Contoh: API-123)..." class="bg-transparent w-full outline-none text-sm font-semibold">
            </div>
            <div class="glass rounded-[2rem] overflow-hidden overflow-x-auto">
                <table class="w-full text-left text-xs min-w-[600px]">
                    <thead class="bg-slate-900 text-[10px] uppercase text-slate-500">
                        <tr><th class="p-6">Invoice</th><th class="p-6">Detail</th><th class="p-6">Status</th><th class="p-6 text-center">Aksi</th></tr>
                    </thead>
                    <tbody id="listInv" class="divide-y divide-white/5"></tbody>
                </table>
            </div>
        </div>
    </main>

    <script>
        // TAB SWITCHER
        function switchTab(t) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.getElementById('tab-'+t).classList.remove('hidden');
            document.querySelectorAll('nav button').forEach(b => b.classList.remove('sidebar-active'));
            document.getElementById('btn-'+t).classList.add('sidebar-active');
            if(t === 'transaksi') renderInv();
        }

        // LOGOUT FUNCTION
        function logout() {
            if(confirm('Apakah Anda yakin ingin keluar?')) {
                // Hapus session jika ada, atau arahkan ke login.html
                window.location.href = 'login.html'; 
            }
        }

        // PRODUCT MANAGEMENT
        const f = document.getElementById('formProduk');
        f.onsubmit = (e) => {
            e.preventDefault();
            let p = JSON.parse(localStorage.getItem('apip_products')) || [];
            let data = { game: f.game.value, sub: f.sub.value, item: f.nama.value, price: f.harga.value };
            
            if(f.editIndex.value === "") {
                p.push(data);
            } else {
                p[f.editIndex.value] = data;
            }
            
            localStorage.setItem('apip_products', JSON.stringify(p));
            resetForm();
            renderProduk();
            alert('Produk berhasil disimpan!');
        };

        function resetForm() {
            f.reset();
            f.editIndex.value = "";
            document.getElementById('formTitle').innerText = "Tambah Produk Baru";
            document.getElementById('btnSimpan').innerText = "Simpan Produk";
        }

        function renderProduk() {
            let p = JSON.parse(localStorage.getItem('apip_products')) || [];
            document.getElementById('listProduk').innerHTML = p.map((x,i) => `
                <tr class="hover:bg-white/5 transition">
                    <td class="p-6">
                        <div class="flex flex-col">
                            <span class="text-xs font-bold text-white">${x.item}</span>
                            <div class="flex items-center space-x-2 mt-1">
                                <span class="text-[9px] bg-blue-500/10 text-blue-400 px-2 py-0.5 rounded uppercase font-bold border border-blue-500/20">${x.game}</span>
                                <span class="text-[9px] text-slate-500 uppercase font-bold">${x.sub}</span>
                            </div>
                        </div>
                    </td>
                    <td class="p-6 text-green-400 font-bold font-mono">Rp ${Number(x.price).toLocaleString()}</td>
                    <td class="p-6 text-center">
                        <div class="flex justify-center space-x-2">
                            <button onclick="editP(${i})" class="w-8 h-8 rounded-lg bg-blue-500/10 text-blue-400 hover:bg-blue-500 hover:text-white transition"><i class="fas fa-edit text-xs"></i></button>
                            <button onclick="hapusP(${i})" class="w-8 h-8 rounded-lg bg-red-500/10 text-red-500 hover:bg-red-500 hover:text-white transition"><i class="fas fa-trash text-xs"></i></button>
                        </div>
                    </td>
                </tr>`).join('');
        }

        function editP(i) {
            let p = JSON.parse(localStorage.getItem('apip_products'))[i];
            f.game.value = p.game; 
            f.sub.value = p.sub; 
            f.nama.value = p.item; 
            f.harga.value = p.price; 
            f.editIndex.value = i;
            
            document.getElementById('formTitle').innerText = "Edit Produk - #" + (i+1);
            document.getElementById('btnSimpan').innerText = "Perbarui Produk";
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function hapusP(i) { 
            if(confirm('Hapus produk ini secara permanen?')) { 
                let p = JSON.parse(localStorage.getItem('apip_products')); 
                p.splice(i,1); 
                localStorage.setItem('apip_products', JSON.stringify(p)); 
                renderProduk(); 
            } 
        }

        // TRANSACTION MANAGEMENT
        function renderInv() {
            let o = JSON.parse(localStorage.getItem('apip_orders')) || [];
            document.getElementById('listInv').innerHTML = o.slice().reverse().map((x,i) => {
                let realI = o.length - 1 - i;
                return `<tr class="inv-row hover:bg-white/5 transition" data-id="${x.id.toUpperCase()}">
                    <td class="p-6"><b class="text-blue-400 font-mono text-sm">${x.id}</b><br><small class="text-slate-500">${x.date}</small></td>
                    <td class="p-6"><b>${x.target}</b><br><span class="text-xs text-slate-400">${x.item}</span></td>
                    <td class="p-6">
                        <select onchange="upStat(${realI},this.value)" class="bg-slate-900 border border-white/10 rounded-lg p-2 text-[10px] outline-none focus:border-blue-500">
                            <option ${x.status=='Pending'?'selected':''}>Pending</option>
                            <option ${x.status=='Sukses'?'selected':''}>Sukses</option>
                            <option ${x.status=='Gagal'?'selected':''}>Gagal</option>
                        </select>
                    </td>
                    <td class="p-6 text-center">
                        <button onclick="hapusI(${realI})" class="w-8 h-8 rounded-lg bg-red-500/10 text-red-500 hover:bg-red-500 hover:text-white transition"><i class="fas fa-trash text-xs"></i></button>
                    </td>
                </tr>`}).join('');
        }

        function hapusI(i) { if(confirm('Hapus riwayat transaksi ini?')) { let o = JSON.parse(localStorage.getItem('apip_orders')); o.splice(i,1); localStorage.setItem('apip_orders', JSON.stringify(o)); renderInv(); } }
        function upStat(i,s) { let o = JSON.parse(localStorage.getItem('apip_orders')); o[i].status = s; localStorage.setItem('apip_orders', JSON.stringify(o)); renderInv(); }
        function cariTabel() {
            let v = document.getElementById('cariInv').value.toUpperCase();
            document.querySelectorAll('.inv-row').forEach(r => r.style.display = r.dataset.id.includes(v) ? '' : 'none');
        }

        // Initialize
        renderProduk();
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MLBB Top Up - APIP STORE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #020617; color: white; -webkit-tap-highlight-color: transparent; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .active-tab { background: #3b82f6 !important; border-color: #3b82f6 !important; box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4); }
        .active-item { border: 2px solid #3b82f6 !important; background: rgba(59, 130, 246, 0.1); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="pb-36 p-4 space-y-6">

    <div class="flex items-center space-x-4 mb-4">
        <a href="index.html" class="w-10 h-10 glass rounded-full flex items-center justify-center">
            <i class="fas fa-arrow-left text-sm"></i>
        </a>
        <div>
            <h1 class="font-black uppercase tracking-widest text-sm">Mobile Legends</h1>
            <p class="text-[9px] text-slate-500 font-bold uppercase">Proses Instan 24 Jam</p>
        </div>
    </div>

    <div class="glass p-5 rounded-[2rem]">
        <div class="flex items-center space-x-3 mb-4">
            <span class="w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center text-[10px] font-bold">1</span>
            <h3 class="font-bold text-sm uppercase">Masukkan ID</h3>
        </div>
        <div class="flex gap-2">
            <input type="number" id="uid" placeholder="User ID" class="w-2/3 bg-slate-900/50 p-4 rounded-2xl outline-none text-sm border border-white/5 focus:border-blue-500 transition">
            <input type="number" id="zid" placeholder="Zone" class="w-1/3 bg-slate-900/50 p-4 rounded-2xl outline-none text-sm border border-white/5 focus:border-blue-500 text-center transition">
        </div>
        <p class="text-[9px] text-slate-500 mt-3 px-1 italic">*Contoh: 12345678 (1234)</p>
    </div>

    <div class="glass p-5 rounded-[2rem]">
        <div class="flex items-center space-x-3 mb-4">
            <span class="w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center text-[10px] font-bold">2</span>
            <h3 class="font-bold text-sm uppercase">Pilih Nominal</h3>
        </div>
        
        <div class="flex space-x-2 mb-6 overflow-x-auto no-scrollbar">
            <button onclick="filterSub('Diamonds ML')" class="sub-tab px-6 py-2 glass rounded-full text-[9px] font-black active-tab whitespace-nowrap transition">DIAMONDS ML</button>
            <button onclick="filterSub('Weekly Pass')" class="sub-tab px-6 py-2 glass rounded-full text-[9px] font-black whitespace-nowrap transition">WEEKLY PASS</button>
        </div>

        <div id="gridProduk" class="grid grid-cols-2 gap-3">
            </div>
    </div>

    <div class="glass p-5 rounded-[2rem]">
        <div class="flex items-center space-x-3 mb-4">
            <span class="w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center text-[10px] font-bold">3</span>
            <h3 class="font-bold text-sm uppercase">Pembayaran</h3>
        </div>
        <div class="grid grid-cols-2 gap-3">
            <div onclick="setPay('QRIS')" id="p-QRIS" class="p-card glass p-4 rounded-2xl text-center border border-white/5 transition active:scale-95">
                <i class="fas fa-qrcode mb-2 text-blue-500 text-xl"></i>
                <p class="text-[10px] font-bold uppercase">QRIS</p>
            </div>
            <div onclick="setPay('DANA')" id="p-DANA" class="p-card glass p-4 rounded-2xl text-center border border-white/5 transition active:scale-95">
                <i class="fas fa-wallet mb-2 text-sky-400 text-xl"></i>
                <p class="text-[10px] font-bold uppercase">DANA</p>
            </div>
        </div>
    </div>

    <div class="fixed bottom-0 left-0 right-0 glass p-6 border-t border-white/10 rounded-t-[2.5rem] flex items-center justify-between z-50">
        <div>
            <p class="text-[9px] text-slate-500 uppercase font-bold">Total Pembayaran</p>
            <p id="totalDisplay" class="text-xl font-black text-blue-500">Rp 0</p>
        </div>
        <button onclick="beli()" class="bg-blue-600 px-8 py-4 rounded-2xl font-black text-xs uppercase shadow-lg shadow-blue-900/40 active:scale-90 transition">
            Beli Sekarang
        </button>
    </div>

    <script>
        let selectedProduct = null;
        let selectedMethod = "";
        let mlProducts = [];

        // 1. Ambil Produk dari Admin (LocalStorage)
        function loadProducts() {
            const allProducts = JSON.parse(localStorage.getItem('apip_products')) || [];
            // Filter hanya produk Mobile Legends
            mlProducts = allProducts.filter(p => p.game === "Mobile Legends");
            
            // Tampilkan kategori pertama secara default
            filterSub('Diamonds ML');
        }

        // 2. Fungsi Filter Tab Sub-Kategori
        function filterSub(subName) {
            // Update UI Tombol Tab
            document.querySelectorAll('.sub-tab').forEach(btn => {
                btn.classList.remove('active-tab');
                if(btn.innerText === subName.toUpperCase()) btn.classList.add('active-tab');
            });

            const grid = document.getElementById('gridProduk');
            const filtered = mlProducts.filter(p => p.sub === subName);

            if(filtered.length === 0) {
                grid.innerHTML = `<p class="col-span-2 text-center text-[10px] py-10 text-slate-500 uppercase font-bold">Produk ${subName} Belum Tersedia</p>`;
                return;
            }

            grid.innerHTML = filtered.map(p => `
                <div onclick="setProduct(this, '${p.item}', ${p.price})" class="item-card glass p-4 rounded-2xl border border-white/5 text-center transition active:scale-95 cursor-pointer">
                    <p class="text-[9px] font-bold uppercase text-slate-400 mb-1">${p.item}</p>
                    <p class="text-xs font-black text-blue-400">Rp ${Number(p.price).toLocaleString()}</p>
                </div>
            `).join('');
        }

        // 3. Pilih Item
        function setProduct(el, name, price) {
            document.querySelectorAll('.item-card').forEach(c => c.classList.remove('active-item'));
            el.classList.add('active-item');
            selectedProduct = { name, price };
            document.getElementById('totalDisplay').innerText = "Rp " + price.toLocaleString();
        }

        // 4. Pilih Metode Pembayaran
        function setPay(method) {
            selectedMethod = method;
            document.querySelectorAll('.p-card').forEach(c => c.classList.remove('active-item'));
            document.getElementById('p-' + method).classList.add('active-item');
        }

        // 5. FUNGSI BELI (Kirim ke Admin)
        function beli() {
            const uid = document.getElementById('uid').value;
            const zid = document.getElementById('zid').value;

            if(!uid || !zid) return alert('Silakan masukkan User ID & Zone!');
            if(!selectedProduct) return alert('Silakan pilih Nominal!');
            if(!selectedMethod) return alert('Silakan pilih Metode Pembayaran!');

            // Buat Data Pesanan
            const orderData = {
                id: "API-" + Math.floor(100000 + Math.random() * 900000), // ID Acak
                game: "Mobile Legends",
                target: `${uid} (${zid})`,
                item: selectedProduct.name,
                price: selectedProduct.price,
                payment: selectedMethod,
                status: "Pending",
                date: new Date().toLocaleString('id-ID')
            };

            // SIMPAN KE DATABASE ADMIN (apip_orders)
            let currentOrders = JSON.parse(localStorage.getItem('apip_orders')) || [];
            currentOrders.push(orderData);
            localStorage.setItem('apip_orders', JSON.stringify(currentOrders));

            // Simpan ke Session untuk Invoice
            sessionStorage.setItem('current_order', JSON.stringify(orderData));

            // Pindah ke Halaman Invoice
            window.location.href = "invoice.html";
        }

        // Jalankan saat load
        window.onload = loadProducts;
    </script>
</body>
</html>